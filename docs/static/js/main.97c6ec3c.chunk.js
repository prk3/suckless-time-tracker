(this["webpackJsonpsuckless-time-tracker"]=this["webpackJsonpsuckless-time-tracker"]||[]).push([[0],{18:function(t,e,n){"use strict";e.a=function(t){t&&t instanceof Function&&n.e(3).then(n.bind(null,37)).then((function(e){var n=e.getCLS,r=e.getFID,a=e.getFCP,c=e.getLCP,s=e.getTTFB;n(t),r(t),a(t),c(t),s(t)}))}},19:function(t,e,n){"use strict";n.d(e,"a",(function(){return I}));var r=n(4),a=n(0),c=n.n(a),s=(n(26),n(2)),i=n(3),o={tasks:[],events:[],activeTask:null,settings:{manDayDuration:i.Duration.fromObject({hours:7}),eventRetentionMonths:3},version:1},u=c.a.createContext({state:o,update:function(){}});function l(t){return JSON.stringify(t)}function d(t){var e=JSON.parse(t);if(1!==e.version)throw new Error('State in unsupported version "'.concat(e.version,'". Update the app.'));return Object(s.a)(Object(s.a)({},e),{},{events:e.events.map((function(t){return Object(s.a)(Object(s.a)({},t),{},{start_time:i.DateTime.fromISO(t.start_time),end_time:t.end_time&&i.DateTime.fromISO(t.end_time)})})),settings:Object(s.a)(Object(s.a)({},e.settings),{},{manDayDuration:i.Duration.fromISO(e.settings.manDayDuration)})})}var f=n(8),m=n(7);function b(t){return Object.fromEntries(t.map((function(t){return[t.id,t]})))}function v(){for(var t="",e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return n.forEach((function(e){!1!==e&&(t=t+" "+e)})),t}function j(t){if(!t)throw console.error("assertion failed!"),console.trace(),new Error("assertion failed")}n(27);var h=n(1);function O(t){var e,n=t.task,r=t.active,a=t.timeSpent,c=t.onActiveChange,s=t.onEstimationChange,i=t.onNameChange,o=t.onDelete,u=t.innerRef,l=null;if(null!==n.estimation){var d,f=a.as("hours")/7,m=f/n.estimation;d=m<.5?"ok":m<.7?"worse":m<.9?"bad":"critical",l=Object(h.jsxs)("span",{children:["Time:"," ",Object(h.jsx)("progress",{className:v(d),value:Math.min(m,1),title:"".concat(f.toFixed(1)," of ").concat(n.estimation," man days"),max:"1"})]})}return Object(h.jsxs)("div",{className:v("task",r&&"active"),onClick:(e=function(){c(!r)},function(t){t.target===t.currentTarget&&e(t)}),ref:u,children:[Object(h.jsx)("div",{children:Object(h.jsx)("textarea",{className:"name",value:n.name,onChange:function(t){i(t.target.value)}})}),Object(h.jsxs)("div",{children:["Estimation: ",Object(h.jsx)("button",{type:"button",className:"button minus",onClick:function(){s((n.estimation||1)-1||null)},children:"-"})," ",Object(h.jsx)("input",{className:"estimation",min:"1",step:"1",type:"number",value:n.estimation||"",onChange:function(t){s(Number(t.target.value)||null)}})," ",Object(h.jsx)("button",{type:"button",className:"button plus",onClick:function(){s((n.estimation||0)+1)},children:"+"})," ",l," ",Object(h.jsx)("button",{type:"button",className:"button",onClick:function(){return window.confirm("You sure?")&&o()},children:"Delete"})]})]},n.id)}n(29);var y=n(11);function k(){var t=c.a.useContext(u),e=t.state,n=t.update,a=c.a.useState(""),o=Object(r.a)(a,2),l=o[0],d=o[1],v=c.a.useMemo((function(){return b(e.tasks)}),[e.tasks]),k=c.a.useMemo((function(){return function(t){var e,n={},r=Object(m.a)(t);try{for(r.s();!(e=r.n()).done;){var a=e.value;n[a.taskId]?n[a.taskId].push(a):n[a.taskId]=[a]}}catch(c){r.e(c)}finally{r.f()}return n}(e.events)}),[e.events]),g=function(t){return function(e){j(void 0!==v[t]),j(!1===v[t].deleted),n((function(n){return Object(s.a)(Object(s.a)({},n),{},{tasks:n.tasks.map((function(n){return n.id!==t?n:Object(s.a)(Object(s.a)({},n),{},{estimation:e})}))})}))}},p=function(t){return function(e){j(void 0!==v[t]),j(!1===v[t].deleted),n((function(n){if(e){j(n.activeTask!==t);var r=Object(f.a)(n.events);return null!==n.activeTask&&(j(r.length>0),j(null===r[r.length-1].end_time),r[r.length-1]=Object(s.a)(Object(s.a)({},r[r.length-1]),{},{end_time:i.DateTime.local()})),r.push({taskId:t,start_time:i.DateTime.local(),end_time:null}),Object(s.a)(Object(s.a)({},n),{},{activeTask:t,events:r})}j(n.activeTask===t);var a=Object(f.a)(n.events);return j(a.length>0),j(null===a[a.length-1].end_time),a[a.length-1]=Object(s.a)(Object(s.a)({},a[a.length-1]),{},{end_time:i.DateTime.local()}),Object(s.a)(Object(s.a)({},n),{},{activeTask:null,events:a})}))}},w=function(t){return function(){j(void 0!==v[t]),j(!1===v[t].deleted),n((function(e){var n,r;return e.activeTask===t?(j((n=Object(f.a)(e.events)).length>0),j(null===n[n.length-1].end_time),n[n.length-1]=Object(s.a)(Object(s.a)({},n[n.length-1]),{},{end_time:i.DateTime.local()}),r=null):(n=e.events,r=e.activeTask),Object(s.a)(Object(s.a)({},e),{},{tasks:e.tasks.map((function(e){return e.id!==t?e:Object(s.a)(Object(s.a)({},e),{},{deleted:!0})})),activeTask:r,events:n})}))}},x=e.tasks.filter((function(t){return!t.deleted})).filter((function(t){return""===l.trim()||t.name.includes(l.trim())})),N=x.map((function(t,r){var a=t.id===e.activeTask,c=function(t){var e=i.Duration.fromObject({seconds:0});return t.forEach((function(t){e=e.plus((t.end_time||i.DateTime.local()).diff(t.start_time))})),e}(k[t.id]||[]);return Object(h.jsx)(y.b,{draggableId:String(t.id),index:r,children:function(e){return Object(h.jsx)("div",{style:{padding:"2.5px 5px"},children:Object(h.jsx)("div",Object(s.a)(Object(s.a)(Object(s.a)({},e.draggableProps),e.dragHandleProps),{},{ref:e.innerRef,children:Object(h.jsx)(O,{task:t,active:a,timeSpent:c,onNameChange:(r=t.id,function(t){j(void 0!==v[r]),j(!1===v[r].deleted),n((function(e){return Object(s.a)(Object(s.a)({},e),{},{tasks:e.tasks.map((function(e){return e.id!==r?e:Object(s.a)(Object(s.a)({},e),{},{name:t})}))})}))}),onEstimationChange:g(t.id),onActiveChange:p(t.id),onDelete:w(t.id)})}))});var r}},t.id)}));return Object(h.jsxs)("div",{children:[Object(h.jsxs)("div",{className:"tasks-bar",children:[Object(h.jsx)("button",{type:"button",className:"button plus",onClick:function(){n((function(t){var e=Math.floor(1e9*Math.random());return Object(s.a)(Object(s.a)({},t),{},{tasks:[{id:e,name:"",estimation:null,deleted:!1}].concat(Object(f.a)(t.tasks))})})),window.setTimeout((function(){var t;null===(t=document.querySelector(".task .name"))||void 0===t||t.focus()}),1)},children:"+"})," ",Object(h.jsx)("input",{type:"text",value:l,placeholder:"Search...",onChange:function(t){d(t.target.value)}})," ",Object(h.jsx)("button",{type:"button",className:"button plus",onClick:function(){return alert("\nGood day!\n\nThis is a small app for time tracking. It's serverless, meaning all data is stored on your device, in local storage*. As you can see, it's pretty basic and not well tested. Probably works only on Firefox. Use it at your own risk.\n\n* You can enable syncing through a self-hosted backend, more on that in README.md at https://github.com/prk3/suckless-time-tracker.\n\nsuckless-time-tracker 0.2.0")},children:"?"})]}),Object(h.jsx)(y.a,{onDragEnd:function(t,e){var a=t.source,c=t.destination;"DROP"===t.reason&&void 0!==c&&n((function(t){var e=t.tasks.findIndex((function(t){return t===x[a.index]})),n=t.tasks.findIndex((function(t){return t===x[c.index]})),i=Object(f.a)(t.tasks),o=i.splice(e,1),u=Object(r.a)(o,1)[0];return i.splice(n,0,u),Object(s.a)(Object(s.a)({},t),{},{tasks:i})}))},children:Object(h.jsx)(y.c,{droppableId:"tasks",children:function(t){return Object(h.jsxs)("div",Object(s.a)(Object(s.a)({},t.droppableProps),{},{ref:t.innerRef,children:[N,t.placeholder]}))}})})]})}function g(t){var e=Math.floor(t.as("minutes"));return e<60?"".concat(e,"m"):e%60===0?"".concat(Math.floor(e/60),"h"):"".concat(Math.floor(e/60),"h").concat(e%60,"m")}function p(t){var e=t.startOfWeek,n=c.a.useContext(u).state,a=c.a.useMemo((function(){return b(n.tasks)}),[n.tasks]),s=function(t){var e,n=[{},{},{},{},{},{},{}],r=Object(m.a)(t);try{for(r.s();!(e=r.n()).done;){var a,c,s=e.value,o=n[s.start_time.weekday-1],u=(s.end_time||i.DateTime.local()).diff(s.start_time);o[s.taskId]=null!==(a=null===(c=o[s.taskId])||void 0===c?void 0:c.plus(u))&&void 0!==a?a:u}}catch(l){r.e(l)}finally{r.f()}return n}(c.a.useMemo((function(){return function(t,e){var n=e.endOf("week");return t.filter((function(t){return t.start_time>=e&&t.start_time<=n}))}(n.events,e)}),[n.events,e]));return Object(h.jsx)("div",{className:"week-view",children:s.map((function(t,n){return Object(h.jsxs)("div",{className:"week-day",children:[Object(h.jsx)("div",{className:"week-day-name",children:e.plus({days:n}).toFormat("cccc")},"day"),Object.entries(t).map((function(t){var e=Object(r.a)(t,2),n=e[0],c=e[1];return Object(h.jsxs)("div",{className:"week-task-log",children:[Object(h.jsx)("div",{className:"week-task-log-name",children:a[n].name}),Object(h.jsx)("div",{className:"week-task-log-time",children:g(c)})]},n)})),Object.keys(t).length>0?Object(h.jsx)("div",{className:"week-task-summary",children:g(Object.values(t).reduce((function(t,e){return t.plus(e)})))}):null]},e.toString()+" "+n)}))})}var w=n(10);function x(t){var e=Math.floor(t.as("minutes"));return e<60?"".concat(e,"m"):e%60===0?"".concat(Math.floor(e/60),"h"):"".concat(Math.floor(e/60),"h").concat(e%60,"m")}function N(t){var e=t.startOfWeek,n=c.a.useContext(u).state,r=c.a.useMemo((function(){return b(n.tasks)}),[n.tasks]),a=function(t){var e,n=[[],[],[],[],[],[],[]],r=Object(m.a)(t);try{for(r.s();!(e=r.n()).done;){var a=e.value;n[a.start_time.weekday-1].push(a)}}catch(c){r.e(c)}finally{r.f()}return n}(c.a.useMemo((function(){return function(t,e){var n=e.endOf("week");return t.filter((function(t){return t.start_time>=e&&t.start_time<=n}))}(n.events,e)}),[n.events,e]));return Object(h.jsxs)("div",{className:"week-timeline-container",children:[Object(h.jsx)("div",{children:Object(w.range)(0,25).map((function(t){return Object(h.jsx)("div",{className:"hour-line",children:t},t)}))}),Object(h.jsx)("div",{className:"week-view week-timeline-view",children:a.map((function(t,n){return Object(h.jsxs)("div",{className:"week-day",children:[Object(h.jsx)("div",{className:"week-day-name",children:e.plus({days:n}).toFormat("cccc")},"day"),Object(h.jsx)("div",{className:"week-day-events",children:t.map((function(t,e){var n,a=960*((n=t.start_time).diff(n.startOf("day")).as("seconds")/86400),c=960*function(t,e){console.log(t.toString(),null===e||void 0===e?void 0:e.toString());var n=e||i.DateTime.local();return t.endOf("day").equals(n.endOf("day"))?n.diff(t).as("seconds")/86400:t.endOf("day").diff(t).as("seconds")/86400}(t.start_time,t.end_time),s=function(t){return Math.max(Math.floor((t-10-10)/17),0)}(c);return Object(h.jsx)("div",{className:"week-event",style:{top:a,height:c},title:r[t.taskId].name+" - "+x((t.end_time||i.DateTime.local()).diff(t.start_time)),children:Object(h.jsx)("div",{className:"week-task-log-name",style:{WebkitLineClamp:s||"none"},children:s>0?r[t.taskId].name:""})},String(t.taskId)+String(e))}))})]},e.toString()+" "+n)}))})]})}n(36);function T(){var t=c.a.useState(i.DateTime.local().startOf("week")),e=Object(r.a)(t,2),n=e[0],a=e[1],s=c.a.useState("summary"),o=Object(r.a)(s,2),u=o[0],l=o[1];return Object(h.jsxs)("div",{children:[Object(h.jsxs)("div",{className:"week-select",children:[Object(h.jsx)("button",{className:"button minus",type:"button",onClick:function(){a(n.minus({weeks:1}))},children:"<"}),Object(h.jsx)("span",{className:"week-range",children:n.toFormat("d LLLL y")+" - "+n.endOf("week").toFormat("d LLLL y")}),Object(h.jsx)("button",{className:"button plus",type:"button",onClick:function(){a(n.plus({weeks:1}))},children:">"})," ",Object(h.jsx)("button",{className:"button plus",type:"button",onClick:function(){l("summary"===u?"timeline":"summary")},children:"\u21b7"})]}),Object(h.jsxs)("div",{children:["summary"===u&&Object(h.jsx)(p,{startOfWeek:n}),"timeline"===u&&Object(h.jsx)(N,{startOfWeek:n})]})]})}function S(){var t=window.localStorage.getItem("state");return t?d(t):(_(o),o)}function C(){var t,e=window.localStorage.getItem("sync");return e?(t=e,JSON.parse(t)):(D(null),null)}function _(t){window.localStorage.setItem("state",l(t))}function D(t){window.localStorage.setItem("sync",function(t){return JSON.stringify(t)}(t))}function E(t,e){return fetch("".concat(e.storageUrl,"/string/").concat(e.version+1),{method:"PUT",body:l(t),headers:{Authorization:"Bearer ".concat(e.authToken)}}).catch((function(t){throw new Error("Request to store app state failed")})).then((function(t){if(200===t.status)return e.version+1;throw 401===t.status?new Error("Unauthorized. Check authToken."):409===t.status?new Error("Conflict detected. You will have to resolve it manually."):new Error("Unexpected response status ".concat(t.status))}))}function I(){var t=c.a.useState(S),e=Object(r.a)(t,2),n=e[0],a=e[1],s=c.a.useRef({state:n,dirty:!1}),i=c.a.useRef({sync:C(),dirty:!1}),o=c.a.useRef(Promise.resolve());c.a.useEffect((function(){var t;i.current.sync&&(o.current=(t=i.current.sync,fetch("".concat(t.storageUrl,"/string"),{method:"GET",headers:{Authorization:"Bearer ".concat(t.authToken)}}).catch((function(t){throw new Error("Request to get app state failed")})).then((function(t){if(200===t.status)return t.text().then((function(t){var e=t.indexOf("\n");return[Number(t.substring(0,e)),d(t.substring(e+1))]}));if(401===t.status)throw new Error("Unauthorized. Check authToken.");if(404===t.status)return null;throw new Error("Unexpected response status ".concat(t.status))}))).then((function(t){if(t){var e=Object(r.a)(t,2),n=e[0],c=e[1];if(i.current.sync.saving&&(i.current.sync.saving=!1,i.current.sync.version+=1,i.current.dirty=!0,i.current.sync.version>n&&(i.current.sync.dirty=!0,i.current.sync.version-=1,i.current.dirty=!0)),i.current.sync.version>n)throw new Error("Server is behind client. Either a bug or storage rollback.");if(i.current.sync.version===n);else{if(!(i.current.sync.version<n)||i.current.sync.dirty)throw new Error("State is dirty and can not be fast-forwarded.");i.current.sync.version=n,i.current.dirty=!0,s.current.state=c,s.current.dirty=!1,a(c)}}})).then((function(){if(i.current.sync.dirty)return i.current.sync.saving=!0,i.current.sync.dirty=!1,D(i.current.sync),i.current.dirty=!1,E(s.current.state,i.current.sync).then((function(t){i.current.sync.saving=!1,i.current.sync.version=t,D(i.current.sync),i.current.dirty=!1})).catch((function(t){i.current.sync.saving=!1,i.current.sync.dirty=!0,D(i.current.sync),i.current.dirty=!1,console.error("Failed to send state to server."),console.error(t)}))})).catch((function(t){console.error("Initializing sync failed."),console.error(t)})))}),[]);var l=c.a.useRef(Object(w.debounce)((function(){_(s.current.state),s.current.dirty=!1,i.current.sync&&(o.current=o.current.then((function(){return i.current.sync.saving=!0,i.current.sync.dirty=!1,D(i.current.sync),i.current.dirty=!1,E(s.current.state,i.current.sync).then((function(t){i.current.sync.saving=!1,i.current.sync.version=t,D(i.current.sync),i.current.dirty=!1})).catch((function(t){i.current.sync.saving=!1,i.current.sync.dirty=!0,D(i.current.sync),i.current.dirty=!1,console.error("Failed to send state to server."),console.error(t)}))})))}),5e3,{trailing:!0,leading:!1}));c.a.useEffect((function(){return window.onbeforeunload=function(){s.current.dirty&&_(s.current.state),i.current.dirty&&D(i.current.sync)},function(){window.onbeforeunload=null}}),[]);var f=c.a.useReducer((function(){return{}}),{}),m=Object(r.a)(f,2)[1],b=c.a.useRef(0);c.a.useEffect((function(){return b.current=window.setInterval(m,6e4),function(){return window.clearInterval(b.current)}}));return Object(h.jsx)(u.Provider,{value:{state:n,update:function(t){var e=t(n);s.current.state=e,s.current.dirty=!0,i.current.sync&&(i.current.sync.dirty=!0,i.current.dirty=!0),l.current(),a(e)}},children:Object(h.jsxs)("div",{className:"App",children:[Object(h.jsx)(k,{}),Object(h.jsx)(T,{})]})})}},20:function(t,e,n){"use strict";n.r(e),function(t){var e=n(0),r=n.n(e),a=n(5),c=n.n(a),s=(n(25),n(19)),i=n(18),o=n(1);t.dbg=function(t){return console.log(t),t},c.a.render(Object(o.jsx)(r.a.StrictMode,{children:Object(o.jsx)(s.a,{})}),document.getElementById("root")),Object(i.a)()}.call(this,n(12))},25:function(t,e,n){},26:function(t,e,n){},27:function(t,e,n){},29:function(t,e,n){},36:function(t,e,n){}},[[20,1,2]]]);
//# sourceMappingURL=main.97c6ec3c.chunk.js.map