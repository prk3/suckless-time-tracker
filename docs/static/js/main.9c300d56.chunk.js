(this["webpackJsonpsuckless-time-tracker"]=this["webpackJsonpsuckless-time-tracker"]||[]).push([[0],{18:function(e,t,n){"use strict";t.a=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,37)).then((function(t){var n=t.getCLS,a=t.getFID,c=t.getFCP,i=t.getLCP,s=t.getTTFB;n(e),a(e),c(e),i(e),s(e)}))}},19:function(e,t,n){"use strict";n.d(t,"a",(function(){return T}));var a=n(4),c=n(0),i=n.n(c),s=(n(26),n(2)),r=n(3),o={tasks:[],events:[],activeTask:null,settings:{manDayDuration:r.Duration.fromObject({hours:7}),eventRetentionMonths:3},version:1},u=i.a.createContext({state:o,update:function(){}});var l=n(8),d=n(7);function f(e){return Object.fromEntries(e.map((function(e){return[e.id,e]})))}function m(){for(var e="",t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];return n.forEach((function(t){!1!==t&&(e=e+" "+t)})),e}function j(e){if(!e)throw console.error("assertion failed!"),console.trace(),new Error("assertion failed")}n(27);var b=n(1);function v(e){var t,n=e.task,a=e.active,c=e.timeSpent,i=e.onActiveChange,s=e.onEstimationChange,r=e.onNameChange,o=e.onDelete,u=e.innerRef,l=null;if(null!==n.estimation){var d,f=c.as("hours")/7,j=f/n.estimation;d=j<.5?"ok":j<.7?"worse":j<.9?"bad":"critical",l=Object(b.jsxs)("span",{children:["Time:"," ",Object(b.jsx)("progress",{className:m(d),value:Math.min(j,1),title:"".concat(f.toFixed(1)," of ").concat(n.estimation," man days"),max:"1"})]})}return Object(b.jsxs)("div",{className:m("task",a&&"active"),onClick:(t=function(){i(!a)},function(e){e.target===e.currentTarget&&t(e)}),ref:u,children:[Object(b.jsx)("div",{children:Object(b.jsx)("textarea",{className:"name",value:n.name,onChange:function(e){r(e.target.value)}})}),Object(b.jsxs)("div",{children:["Estimation: ",Object(b.jsx)("button",{type:"button",className:"button minus",onClick:function(){s((n.estimation||1)-1||null)},children:"-"})," ",Object(b.jsx)("input",{className:"estimation",min:"1",step:"1",type:"number",value:n.estimation||"",onChange:function(e){s(Number(e.target.value)||null)}})," ",Object(b.jsx)("button",{type:"button",className:"button plus",onClick:function(){s((n.estimation||0)+1)},children:"+"})," ",l," ",Object(b.jsx)("button",{type:"button",className:"button",onClick:function(){return window.confirm("You sure?")&&o()},children:"Delete"})]})]},n.id)}n(29);var O=n(11);function h(){var e=i.a.useContext(u),t=e.state,n=e.update,c=i.a.useState(""),o=Object(a.a)(c,2),m=o[0],h=o[1],k=i.a.useMemo((function(){return f(t.tasks)}),[t.tasks]),g=i.a.useMemo((function(){return function(e){var t,n={},a=Object(d.a)(e);try{for(a.s();!(t=a.n()).done;){var c=t.value;n[c.taskId]?n[c.taskId].push(c):n[c.taskId]=[c]}}catch(i){a.e(i)}finally{a.f()}return n}(t.events)}),[t.events]),p=function(e){return function(t){j(void 0!==k[e]),j(!1===k[e].deleted),n((function(n){return Object(s.a)(Object(s.a)({},n),{},{tasks:n.tasks.map((function(n){return n.id!==e?n:Object(s.a)(Object(s.a)({},n),{},{estimation:t})}))})}))}},x=function(e){return function(t){j(void 0!==k[e]),j(!1===k[e].deleted),n((function(n){if(t){j(n.activeTask!==e);var a=Object(l.a)(n.events);return null!==n.activeTask&&(j(a.length>0),j(null===a[a.length-1].end_time),a[a.length-1]=Object(s.a)(Object(s.a)({},a[a.length-1]),{},{end_time:r.DateTime.local()})),a.push({taskId:e,start_time:r.DateTime.local(),end_time:null}),Object(s.a)(Object(s.a)({},n),{},{activeTask:e,events:a})}j(n.activeTask===e);var c=Object(l.a)(n.events);return j(c.length>0),j(null===c[c.length-1].end_time),c[c.length-1]=Object(s.a)(Object(s.a)({},c[c.length-1]),{},{end_time:r.DateTime.local()}),Object(s.a)(Object(s.a)({},n),{},{activeTask:null,events:c})}))}},y=function(e){return function(){j(void 0!==k[e]),j(!1===k[e].deleted),n((function(t){var n,a;return t.activeTask===e?(j((n=Object(l.a)(t.events)).length>0),j(null===n[n.length-1].end_time),n[n.length-1]=Object(s.a)(Object(s.a)({},n[n.length-1]),{},{end_time:r.DateTime.local()}),a=null):(n=t.events,a=t.activeTask),Object(s.a)(Object(s.a)({},t),{},{tasks:t.tasks.map((function(t){return t.id!==e?t:Object(s.a)(Object(s.a)({},t),{},{deleted:!0})})),activeTask:a,events:n})}))}},w=t.tasks.filter((function(e){return!e.deleted})).filter((function(e){return""===m.trim()||e.name.includes(m.trim())})),N=w.map((function(e,a){var c=e.id===t.activeTask,i=function(e){var t=r.Duration.fromObject({seconds:0});return e.forEach((function(e){t=t.plus((e.end_time||r.DateTime.local()).diff(e.start_time))})),t}(g[e.id]||[]);return Object(b.jsx)(O.b,{draggableId:String(e.id),index:a,children:function(t){return Object(b.jsx)("div",{style:{padding:"2.5px 5px"},children:Object(b.jsx)("div",Object(s.a)(Object(s.a)(Object(s.a)({},t.draggableProps),t.dragHandleProps),{},{ref:t.innerRef,children:Object(b.jsx)(v,{task:e,active:c,timeSpent:i,onNameChange:(a=e.id,function(e){j(void 0!==k[a]),j(!1===k[a].deleted),n((function(t){return Object(s.a)(Object(s.a)({},t),{},{tasks:t.tasks.map((function(t){return t.id!==a?t:Object(s.a)(Object(s.a)({},t),{},{name:e})}))})}))}),onEstimationChange:p(e.id),onActiveChange:x(e.id),onDelete:y(e.id)})}))});var a}},e.id)}));return Object(b.jsxs)("div",{children:[Object(b.jsxs)("div",{className:"tasks-bar",children:[Object(b.jsx)("button",{type:"button",className:"button plus",onClick:function(){n((function(e){var t=Math.floor(1e9*Math.random());return Object(s.a)(Object(s.a)({},e),{},{tasks:[{id:t,name:"",estimation:null,deleted:!1}].concat(Object(l.a)(e.tasks))})})),window.setTimeout((function(){var e;null===(e=document.querySelector(".task .name"))||void 0===e||e.focus()}),1)},children:"+"})," ",Object(b.jsx)("input",{type:"text",value:m,placeholder:"Search...",onChange:function(e){h(e.target.value)}})," ",Object(b.jsx)("button",{type:"button",className:"button plus",onClick:function(){return alert("\nGood day!\n\nThis is a small app for time tracking. It's serverless, meaning all data is stored on your device, in local storage. As you can see, it's pretty basic and not well tested. Probably works only on Firefox. Use it at your own risk.\n\nFell free to make backups of the page. If you only want to only save the time data, you can get it with window.localStorage.getItem('state').")},children:"?"})]}),Object(b.jsx)(O.a,{onDragEnd:function(e,t){var c=e.source,i=e.destination;"DROP"===e.reason&&void 0!==i&&n((function(e){var t=e.tasks.findIndex((function(e){return e===w[c.index]})),n=e.tasks.findIndex((function(e){return e===w[i.index]})),r=Object(l.a)(e.tasks),o=r.splice(t,1),u=Object(a.a)(o,1)[0];return r.splice(n,0,u),Object(s.a)(Object(s.a)({},e),{},{tasks:r})}))},children:Object(b.jsx)(O.c,{droppableId:"tasks",children:function(e){return Object(b.jsxs)("div",Object(s.a)(Object(s.a)({},e.droppableProps),{},{ref:e.innerRef,children:[N,e.placeholder]}))}})})]})}function k(e){var t=Math.floor(e.as("minutes"));return t<60?"".concat(t,"m"):t%60===0?"".concat(Math.floor(t/60),"h"):"".concat(Math.floor(t/60),"h").concat(t%60,"m")}function g(e){var t=e.startOfWeek,n=i.a.useContext(u).state,c=i.a.useMemo((function(){return f(n.tasks)}),[n.tasks]),s=function(e){var t,n=[{},{},{},{},{},{},{}],a=Object(d.a)(e);try{for(a.s();!(t=a.n()).done;){var c,i,s=t.value,o=n[s.start_time.weekday-1],u=(s.end_time||r.DateTime.local()).diff(s.start_time);o[s.taskId]=null!==(c=null===(i=o[s.taskId])||void 0===i?void 0:i.plus(u))&&void 0!==c?c:u}}catch(l){a.e(l)}finally{a.f()}return n}(i.a.useMemo((function(){return function(e,t){var n=t.endOf("week");return e.filter((function(e){return e.start_time>=t&&e.start_time<=n}))}(n.events,t)}),[n.events,t]));return Object(b.jsx)("div",{className:"week-view",children:s.map((function(e,n){return Object(b.jsxs)("div",{className:"week-day",children:[Object(b.jsx)("div",{className:"week-day-name",children:t.plus({days:n}).toFormat("cccc")},"day"),Object.entries(e).map((function(e){var t=Object(a.a)(e,2),n=t[0],i=t[1];return Object(b.jsxs)("div",{className:"week-task-log",children:[Object(b.jsx)("div",{className:"week-task-log-name",children:c[n].name}),Object(b.jsx)("div",{className:"week-task-log-time",children:k(i)})]},n)})),Object.keys(e).length>0?Object(b.jsx)("div",{className:"week-task-summary",children:k(Object.values(e).reduce((function(e,t){return e.plus(t)})))}):null]},t.toString()+" "+n)}))})}var p=n(10);function x(e){var t=Math.floor(e.as("minutes"));return t<60?"".concat(t,"m"):t%60===0?"".concat(Math.floor(t/60),"h"):"".concat(Math.floor(t/60),"h").concat(t%60,"m")}function y(e){var t=e.startOfWeek,n=i.a.useContext(u).state,a=i.a.useMemo((function(){return f(n.tasks)}),[n.tasks]),c=function(e){var t,n=[[],[],[],[],[],[],[]],a=Object(d.a)(e);try{for(a.s();!(t=a.n()).done;){var c=t.value;n[c.start_time.weekday-1].push(c)}}catch(i){a.e(i)}finally{a.f()}return n}(i.a.useMemo((function(){return function(e,t){var n=t.endOf("week");return e.filter((function(e){return e.start_time>=t&&e.start_time<=n}))}(n.events,t)}),[n.events,t]));return Object(b.jsxs)("div",{className:"week-timeline-container",children:[Object(b.jsx)("div",{children:Object(p.range)(0,25).map((function(e){return Object(b.jsx)("div",{className:"hour-line",children:e},e)}))}),Object(b.jsx)("div",{className:"week-view week-timeline-view",children:c.map((function(e,n){return Object(b.jsxs)("div",{className:"week-day",children:[Object(b.jsx)("div",{className:"week-day-name",children:t.plus({days:n}).toFormat("cccc")},"day"),Object(b.jsx)("div",{className:"week-day-events",children:e.map((function(e,t){var n,c=960*((n=e.start_time).diff(n.startOf("day")).as("seconds")/86400),i=960*function(e,t){console.log(e.toString(),null===t||void 0===t?void 0:t.toString());var n=t||r.DateTime.local();return e.endOf("day").equals(n.endOf("day"))?n.diff(e).as("seconds")/86400:e.endOf("day").diff(e).as("seconds")/86400}(e.start_time,e.end_time),s=function(e){return Math.max(Math.floor((e-10-10)/17),0)}(i);return Object(b.jsx)("div",{className:"week-event",style:{top:c,height:i},title:a[e.taskId].name+" - "+x((e.end_time||r.DateTime.local()).diff(e.start_time)),children:Object(b.jsx)("div",{className:"week-task-log-name",style:{WebkitLineClamp:s||"none"},children:s>0?a[e.taskId].name:""})},String(e.taskId)+String(t))}))})]},t.toString()+" "+n)}))})]})}n(36);function w(){var e=i.a.useState(r.DateTime.local().startOf("week")),t=Object(a.a)(e,2),n=t[0],c=t[1],s=i.a.useState("summary"),o=Object(a.a)(s,2),u=o[0],l=o[1];return Object(b.jsxs)("div",{children:[Object(b.jsxs)("div",{className:"week-select",children:[Object(b.jsx)("button",{className:"button minus",type:"button",onClick:function(){c(n.minus({weeks:1}))},children:"<"}),Object(b.jsx)("span",{className:"week-range",children:n.toFormat("d LLLL y")+" - "+n.endOf("week").toFormat("d LLLL y")}),Object(b.jsx)("button",{className:"button plus",type:"button",onClick:function(){c(n.plus({weeks:1}))},children:">"})," ",Object(b.jsx)("button",{className:"button plus",type:"button",onClick:function(){l("summary"===u?"timeline":"summary")},children:"\u21b7"})]}),Object(b.jsxs)("div",{children:["summary"===u&&Object(b.jsx)(g,{startOfWeek:n}),"timeline"===u&&Object(b.jsx)(y,{startOfWeek:n})]})]})}function N(){var e=window.localStorage.getItem("state");return e?function(e){var t=JSON.parse(e);return Object(s.a)(Object(s.a)({},t),{},{events:t.events.map((function(e){return Object(s.a)(Object(s.a)({},e),{},{start_time:r.DateTime.fromISO(e.start_time),end_time:e.end_time&&r.DateTime.fromISO(e.end_time)})})),settings:Object(s.a)(Object(s.a)({},t.settings),{},{manDayDuration:r.Duration.fromISO(t.settings.manDayDuration)})})}(e):(_(o),o)}function _(e){window.localStorage.setItem("state",JSON.stringify(e))}function T(){var e=i.a.useState(N),t=Object(a.a)(e,2),n=t[0],c=t[1],s=i.a.useReducer((function(){return{}}),{}),r=Object(a.a)(s,2)[1],o=i.a.useRef(0);i.a.useEffect((function(){return o.current=window.setInterval(r,6e4),function(){return window.clearInterval(o.current)}}));var l=i.a.useRef({state:n,dirty:!1}),d=i.a.useRef(Object(p.debounce)((function(){_(l.current.state),l.current.dirty=!1}),5e3,{trailing:!0,leading:!1}));i.a.useEffect((function(){return window.onbeforeunload=function(){l.current.dirty&&_(l.current.state)},function(){window.onbeforeunload=null}}));return Object(b.jsx)(u.Provider,{value:{state:n,update:function(e){var t=e(n);l.current.state=t,l.current.dirty=!0,d.current(),c(t)}},children:Object(b.jsxs)("div",{className:"App",children:[Object(b.jsx)(h,{}),Object(b.jsx)(w,{})]})})}},20:function(e,t,n){"use strict";n.r(t),function(e){var t=n(0),a=n.n(t),c=n(5),i=n.n(c),s=(n(25),n(19)),r=n(18),o=n(1);e.dbg=function(e){return console.log(e),e},i.a.render(Object(o.jsx)(a.a.StrictMode,{children:Object(o.jsx)(s.a,{})}),document.getElementById("root")),Object(r.a)()}.call(this,n(12))},25:function(e,t,n){},26:function(e,t,n){},27:function(e,t,n){},29:function(e,t,n){},36:function(e,t,n){}},[[20,1,2]]]);
//# sourceMappingURL=main.9c300d56.chunk.js.map