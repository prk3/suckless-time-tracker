(this["webpackJsonpsuckless-time-tracker"]=this["webpackJsonpsuckless-time-tracker"]||[]).push([[0],{12:function(e,t,n){"use strict";n.d(t,"a",(function(){return v})),n.d(t,"b",(function(){return b}));var r=n(4),a=n(8),c=n(0),i=n.n(c),s=n(5),u=n(1),o=12e4;function l(){var e,t=window.localStorage.getItem("sync");return t?(e=t,JSON.parse(e)):(d(null),null)}function d(e){window.localStorage.setItem("sync",function(e){return JSON.stringify(e)}(e))}var f=i.a.createContext({status:"off"});function v(e){var t=e.children,n=i.a.useState(l),a=Object(r.a)(n,1)[0];return null!==a?Object(u.jsx)(m,{initSync:a,children:t}):Object(u.jsx)(f.Provider,{value:{status:"off"},children:t})}function m(e){var t=e.initSync,n=e.children,c=Object(s.d)(),l=c.state,v=c.updateState,m=i.a.useRef(l),b=i.a.useRef(t),j=i.a.useRef(null),h=i.a.useState("off"),O=Object(r.a)(h,2),k=O[0],g=O[1],w=i.a.useRef(new Date),p=i.a.useRef(!0),y=i.a.useRef((function(){var e;p.current&&(g("syncing"),(e=b.current,fetch("".concat(e.storageUrl,"/string"),{method:"GET",headers:{Authorization:"Bearer ".concat(e.authToken)}}).catch((function(e){throw new Error("Request to get app state failed")})).then((function(e){if(200===e.status)return e.text().then((function(e){var t=e.indexOf("\n");return[Number(e.substring(0,t)),Object(s.b)(e.substring(t+1))]}));if(401===e.status)throw new Error("Unauthorized. Check authToken.");if(404===e.status)return null;throw new Error("Unexpected response status ".concat(e.status))}))).then((function(e){if(p.current&&e){var t=Object(r.a)(e,2),n=t[0],a=t[1];if(b.current.saving&&(b.current.saving=!1,b.current.version+=1,b.current.version>n&&(b.current.dirty=!0,b.current.version-=1)),b.current.version>n)throw new Error("Server is behind client. Either a bug or storage rollback.");if(b.current.version===n);else{if(!(b.current.version<n)||b.current.dirty)throw new Error("State is dirty and can not be fast-forwarded.");b.current.version=n,m.current=a,v((function(){return a}))}}})).then((function(){var e,t;p.current&&(d(b.current),j.current=x(),b.current.dirty?(null===(e=j.current)||void 0===e||e.call(j),null===(t=j.current)||void 0===t||t.flush()):g("synced"))})).catch((function(e){p.current&&(g("error"),console.error("Initializing sync failed."),console.error(e))})))}));function x(){return Object(a.debounce)((function(){var e;if(p.current)return null===(e=j.current)||void 0===e||e.cancel(),j.current=null,b.current.saving=!0,b.current.dirty=!1,d(b.current),g("syncing"),function(e,t){return fetch("".concat(t.storageUrl,"/string/").concat(t.version+1),{method:"PUT",body:Object(s.c)(e),headers:{Authorization:"Bearer ".concat(t.authToken)}}).catch((function(e){throw new Error("Request to store app state failed")})).then((function(e){if(200===e.status)return t.version+1;throw 401===e.status?new Error("Unauthorized. Check authToken."):409===e.status?new Error("Conflict detected. You will have to resolve it manually."):new Error("Unexpected response status ".concat(e.status))}))}(m.current,b.current).then((function(e){var t;p.current&&(b.current.saving=!1,b.current.version=e,d(b.current),j.current=x(),b.current.dirty?(null===(t=j.current)||void 0===t||t.call(j),g("dirty")):g("synced"))})).catch((function(e){if(p.current){var t,n=b.current.dirty;if(b.current.saving=!1,b.current.dirty=!0,d(b.current),console.error("Failed to send state to server."),console.error(e),j.current=x(),n)null===(t=j.current)||void 0===t||t.call(j),g("dirty");else g("error")}}))}),1e3,{trailing:!0,leading:!1})}return i.a.useEffect((function(){var e;l!==m.current&&(m.current=l,b.current.dirty||(b.current.dirty=!0,d(b.current),null!==j.current&&g("dirty")),null===(e=j.current)||void 0===e||e.call(j))}),[l]),i.a.useEffect((function(){var e=function(){null!==j.current&&(j.current.cancel(),j.current=null,y.current(),w.current=new Date)};return window.addEventListener("focus",e),function(){return window.removeEventListener("focus",e)}}),[]),i.a.useEffect((function(){var e=window.setInterval((function(){var e=new Date;null!==j.current&&e.getTime()-w.current.getTime()>o&&(console.log("".concat(o,"ms passed, resyncing")),j.current.cancel(),j.current=null,y.current(),w.current=e)}),5e3);return function(){return window.clearInterval(e)}}),[]),i.a.useEffect((function(){return y.current(),function(){var e;p.current=!1,null===(e=j.current)||void 0===e||e.cancel(),j.current=null}}),[]),Object(u.jsx)(f.Provider,{value:{status:k},children:n})}function b(){return i.a.useContext(f)}},20:function(e,t,n){"use strict";t.a=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,38)).then((function(t){var n=t.getCLS,r=t.getFID,a=t.getFCP,c=t.getLCP,i=t.getTTFB;n(e),r(e),a(e),c(e),i(e)}))}},21:function(e,t,n){"use strict";n.d(t,"a",(function(){return E}));var r=n(4),a=n(0),c=n.n(a),i=n(10),s=n(2),u=n(3),o=n(5),l=n(9);function d(e){return Object.fromEntries(e.map((function(e){return[e.id,e]})))}function f(){for(var e="",t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return n.forEach((function(t){!1!==t&&(e=e+" "+t)})),e}function v(e){if(!e)throw console.error("assertion failed!"),console.trace(),new Error("assertion failed")}n(29);var m=n(1);function b(e){var t,n=e.task,r=e.active,a=e.timeSpent,c=e.onActiveChange,i=e.onEstimationChange,s=e.onNameChange,u=e.onDelete,o=e.innerRef,l=null;if(null!==n.estimation){var d,v=a.as("hours")/7,b=v/n.estimation;d=b<.5?"ok":b<.7?"worse":b<.9?"bad":"critical",l=Object(m.jsxs)("span",{children:["Time:"," ",Object(m.jsx)("progress",{className:f(d),value:Math.min(b,1),title:"".concat(v.toFixed(1)," of ").concat(n.estimation," man days"),max:"1"})]})}return Object(m.jsxs)("div",{className:f("task",r&&"active"),onClick:(t=function(){c(!r)},function(e){e.target===e.currentTarget&&t(e)}),ref:o,children:[Object(m.jsx)("div",{children:Object(m.jsx)("textarea",{className:"name",value:n.name,onChange:function(e){s(e.target.value)}})}),Object(m.jsxs)("div",{children:["Estimation: ",Object(m.jsx)("button",{type:"button",className:"button minus",onClick:function(){i((n.estimation||1)-1||null)},children:"-"})," ",Object(m.jsx)("input",{className:"estimation",min:"1",step:"1",type:"number",value:n.estimation||"",onChange:function(e){i(Number(e.target.value)||null)}})," ",Object(m.jsx)("button",{type:"button",className:"button plus",onClick:function(){i((n.estimation||0)+1)},children:"+"})," ",l," ",Object(m.jsx)("button",{type:"button",className:"button",onClick:function(){return window.confirm("You sure?")&&u()},children:"Delete"})]})]},n.id)}n(30);var j=n(13),h=n(12),O="\nGood day!\n\nThis is a small app for time tracking. It's serverless, meaning all data is stored on your device, in local storage*. As you can see, it's pretty basic and not well tested. Probably works only on Firefox. Use it at your own risk.\n\n* You can enable syncing through a self-hosted backend, more on that in README.md at https://github.com/prk3/suckless-time-tracker.\n\nsuckless-time-tracker ".concat(Object({NODE_ENV:"production",PUBLIC_URL:".",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}).npm_package_version);function k(){var e=Object(o.d)(),t=e.state,n=e.updateState,a=Object(h.b)().status,f=c.a.useState(""),k=Object(r.a)(f,2),g=k[0],w=k[1],p=c.a.useMemo((function(){return d(t.tasks)}),[t.tasks]),y=c.a.useMemo((function(){return function(e){var t,n={},r=Object(l.a)(e);try{for(r.s();!(t=r.n()).done;){var a=t.value;n[a.taskId]?n[a.taskId].push(a):n[a.taskId]=[a]}}catch(c){r.e(c)}finally{r.f()}return n}(t.events)}),[t.events]),x=function(e){return function(t){v(void 0!==p[e]),v(!1===p[e].deleted),n((function(n){return Object(s.a)(Object(s.a)({},n),{},{tasks:n.tasks.map((function(n){return n.id!==e?n:Object(s.a)(Object(s.a)({},n),{},{estimation:t})}))})}))}},S=function(e){return function(t){v(void 0!==p[e]),v(!1===p[e].deleted),n((function(n){if(t){v(n.activeTask!==e);var r=Object(i.a)(n.events);return null!==n.activeTask&&(v(r.length>0),v(null===r[r.length-1].end_time),r[r.length-1]=Object(s.a)(Object(s.a)({},r[r.length-1]),{},{end_time:u.DateTime.local()})),r.push({taskId:e,start_time:u.DateTime.local(),end_time:null}),Object(s.a)(Object(s.a)({},n),{},{activeTask:e,events:r})}v(n.activeTask===e);var a=Object(i.a)(n.events);return v(a.length>0),v(null===a[a.length-1].end_time),a[a.length-1]=Object(s.a)(Object(s.a)({},a[a.length-1]),{},{end_time:u.DateTime.local()}),Object(s.a)(Object(s.a)({},n),{},{activeTask:null,events:a})}))}},E=function(e){return function(){v(void 0!==p[e]),v(!1===p[e].deleted),n((function(t){var n,r;return t.activeTask===e?(v((n=Object(i.a)(t.events)).length>0),v(null===n[n.length-1].end_time),n[n.length-1]=Object(s.a)(Object(s.a)({},n[n.length-1]),{},{end_time:u.DateTime.local()}),r=null):(n=t.events,r=t.activeTask),Object(s.a)(Object(s.a)({},t),{},{tasks:t.tasks.map((function(t){return t.id!==e?t:Object(s.a)(Object(s.a)({},t),{},{deleted:!0})})),activeTask:r,events:n})}))}},N=t.tasks.filter((function(e){return!e.deleted})).filter((function(e){return""===g.trim()||e.name.includes(g.trim())})),T=N.map((function(e,r){var a=e.id===t.activeTask,c=function(e){var t=u.Duration.fromObject({seconds:0});return e.forEach((function(e){t=t.plus((e.end_time||u.DateTime.local()).diff(e.start_time))})),t}(y[e.id]||[]);return Object(m.jsx)(j.b,{draggableId:String(e.id),index:r,children:function(t){return Object(m.jsx)("div",{style:{padding:"2.5px 5px"},children:Object(m.jsx)("div",Object(s.a)(Object(s.a)(Object(s.a)({},t.draggableProps),t.dragHandleProps),{},{ref:t.innerRef,children:Object(m.jsx)(b,{task:e,active:a,timeSpent:c,onNameChange:(r=e.id,function(e){v(void 0!==p[r]),v(!1===p[r].deleted),n((function(t){return Object(s.a)(Object(s.a)({},t),{},{tasks:t.tasks.map((function(t){return t.id!==r?t:Object(s.a)(Object(s.a)({},t),{},{name:e})}))})}))}),onEstimationChange:x(e.id),onActiveChange:S(e.id),onDelete:E(e.id)})}))});var r}},e.id)}));return Object(m.jsxs)("div",{children:[Object(m.jsxs)("div",{className:"tasks-bar",children:[Object(m.jsx)("button",{type:"button",className:"button plus",onClick:function(){n((function(e){var t=Math.floor(1e9*Math.random());return Object(s.a)(Object(s.a)({},e),{},{tasks:[{id:t,name:"",estimation:null,deleted:!1}].concat(Object(i.a)(e.tasks))})})),window.setTimeout((function(){var e;null===(e=document.querySelector(".task .name"))||void 0===e||e.focus()}),1)},children:"+"})," ",Object(m.jsx)("input",{type:"text",value:g,placeholder:"Search...",onChange:function(e){w(e.target.value)}})," ",Object(m.jsx)("button",{type:"button",className:"button plus",onClick:function(){return alert(O)},children:"?"})," ",Object(m.jsx)("span",{className:"sync-indicator sync-indicator-"+a,children:"\u25cf"})]}),Object(m.jsx)(j.a,{onDragEnd:function(e,t){var a=e.source,c=e.destination;"DROP"===e.reason&&void 0!==c&&n((function(e){var t=e.tasks.findIndex((function(e){return e===N[a.index]})),n=e.tasks.findIndex((function(e){return e===N[c.index]})),u=Object(i.a)(e.tasks),o=u.splice(t,1),l=Object(r.a)(o,1)[0];return u.splice(n,0,l),Object(s.a)(Object(s.a)({},e),{},{tasks:u})}))},children:Object(m.jsx)(j.c,{droppableId:"tasks",children:function(e){return Object(m.jsxs)("div",Object(s.a)(Object(s.a)({},e.droppableProps),{},{ref:e.innerRef,children:[T,e.placeholder]}))}})})]})}function g(e){var t=Math.floor(e.as("minutes"));return t<60?"".concat(t,"m"):t%60===0?"".concat(Math.floor(t/60),"h"):"".concat(Math.floor(t/60),"h").concat(t%60,"m")}function w(e){var t=e.startOfWeek,n=Object(o.d)().state,a=c.a.useMemo((function(){return d(n.tasks)}),[n.tasks]),i=c.a.useMemo((function(){return function(e,t){var n=t.endOf("week");return e.filter((function(e){return e.start_time>=t&&e.start_time<=n}))}(n.events,t)}),[n.events,t]),s=function(e){var t,n=[{},{},{},{},{},{},{}],r=Object(l.a)(e);try{for(r.s();!(t=r.n()).done;){var a,c,i=t.value,s=n[i.start_time.weekday-1],o=(i.end_time||u.DateTime.local()).diff(i.start_time);s[i.taskId]=null!==(a=null===(c=s[i.taskId])||void 0===c?void 0:c.plus(o))&&void 0!==a?a:o}}catch(d){r.e(d)}finally{r.f()}return n}(i);return Object(m.jsx)("div",{className:"week-view",children:s.map((function(e,n){return Object(m.jsxs)("div",{className:"week-day",children:[Object(m.jsx)("div",{className:"week-day-name",children:t.plus({days:n}).toFormat("cccc")},"day"),Object.entries(e).map((function(e){var t=Object(r.a)(e,2),n=t[0],c=t[1];return Object(m.jsxs)("div",{className:"week-task-log",children:[Object(m.jsx)("div",{className:"week-task-log-name",children:a[n].name}),Object(m.jsx)("div",{className:"week-task-log-time",children:g(c)})]},n)})),Object.keys(e).length>0?Object(m.jsx)("div",{className:"week-task-summary",children:g(Object.values(e).reduce((function(e,t){return e.plus(t)})))}):null]},t.toString()+" "+n)}))})}var p=n(8);function y(e){var t=Math.floor(e.as("minutes"));return t<60?"".concat(t,"m"):t%60===0?"".concat(Math.floor(t/60),"h"):"".concat(Math.floor(t/60),"h").concat(t%60,"m")}function x(e){var t=e.startOfWeek,n=Object(o.d)().state,r=c.a.useMemo((function(){return d(n.tasks)}),[n.tasks]),a=c.a.useMemo((function(){return function(e,t){var n=t.endOf("week");return e.filter((function(e){return e.start_time>=t&&e.start_time<=n}))}(n.events,t)}),[n.events,t]),i=function(e){var t,n=[[],[],[],[],[],[],[]],r=Object(l.a)(e);try{for(r.s();!(t=r.n()).done;){var a=t.value;n[a.start_time.weekday-1].push(a)}}catch(c){r.e(c)}finally{r.f()}return n}(a);return Object(m.jsxs)("div",{className:"week-timeline-container",children:[Object(m.jsx)("div",{children:Object(p.range)(0,25).map((function(e){return Object(m.jsx)("div",{className:"hour-line",children:e},e)}))}),Object(m.jsx)("div",{className:"week-view week-timeline-view",children:i.map((function(e,n){return Object(m.jsxs)("div",{className:"week-day",children:[Object(m.jsx)("div",{className:"week-day-name",children:t.plus({days:n}).toFormat("cccc")},"day"),Object(m.jsx)("div",{className:"week-day-events",children:e.map((function(e,t){var n,a=960*((n=e.start_time).diff(n.startOf("day")).as("seconds")/86400),c=960*function(e,t){console.log(e.toString(),null===t||void 0===t?void 0:t.toString());var n=t||u.DateTime.local();return e.endOf("day").equals(n.endOf("day"))?n.diff(e).as("seconds")/86400:e.endOf("day").diff(e).as("seconds")/86400}(e.start_time,e.end_time),i=function(e){return Math.max(Math.floor((e-10-10)/17),0)}(c);return Object(m.jsx)("div",{className:"week-event",style:{top:a,height:c},title:r[e.taskId].name+" - "+y((e.end_time||u.DateTime.local()).diff(e.start_time)),children:Object(m.jsx)("div",{className:"week-task-log-name",style:{WebkitLineClamp:i||"none"},children:i>0?r[e.taskId].name:""})},String(e.taskId)+String(t))}))})]},t.toString()+" "+n)}))})]})}n(36);function S(){var e=c.a.useState(u.DateTime.local().startOf("week")),t=Object(r.a)(e,2),n=t[0],a=t[1],i=c.a.useState("summary"),s=Object(r.a)(i,2),o=s[0],l=s[1];return Object(m.jsxs)("div",{children:[Object(m.jsxs)("div",{className:"week-select",children:[Object(m.jsx)("button",{className:"button minus",type:"button",onClick:function(){a(n.minus({weeks:1}))},children:"<"}),Object(m.jsx)("span",{className:"week-range",children:n.toFormat("d LLLL y")+" - "+n.endOf("week").toFormat("d LLLL y")}),Object(m.jsx)("button",{className:"button plus",type:"button",onClick:function(){a(n.plus({weeks:1}))},children:">"})," ",Object(m.jsx)("button",{className:"button plus",type:"button",onClick:function(){l("summary"===o?"timeline":"summary")},children:"\u21b7"})]}),Object(m.jsxs)("div",{children:["summary"===o&&Object(m.jsx)(w,{startOfWeek:n}),"timeline"===o&&Object(m.jsx)(x,{startOfWeek:n})]})]})}function E(){var e=c.a.useReducer((function(){return{}}),{}),t=Object(r.a)(e,2)[1];return c.a.useEffect((function(){var e=window.setInterval(t,6e4);return function(){return window.clearInterval(e)}}),[]),c.a.useEffect((function(){return window.addEventListener("focus",t),function(){return window.removeEventListener("focus",t)}}),[]),Object(m.jsxs)("div",{className:"App",children:[Object(m.jsx)(k,{}),Object(m.jsx)(S,{})]})}},22:function(e,t,n){"use strict";n.r(t),function(e){var t=n(0),r=n.n(t),a=n(6),c=n.n(a),i=n(21),s=n(20),u=n(5),o=n(12),l=(n(37),n(1));e.dbg=function(e){return console.log(e),e},c.a.render(Object(l.jsx)(r.a.StrictMode,{children:Object(l.jsx)(u.a,{children:Object(l.jsx)(o.a,{children:Object(l.jsx)(i.a,{})})})}),document.getElementById("root")),Object(s.a)()}.call(this,n(14))},29:function(e,t,n){},30:function(e,t,n){},36:function(e,t,n){},37:function(e,t,n){},5:function(e,t,n){"use strict";n.d(t,"c",(function(){return f})),n.d(t,"b",(function(){return v})),n.d(t,"a",(function(){return j})),n.d(t,"d",(function(){return h}));var r=n(4),a=n(2),c=n(8),i=n(3),s=n(0),u=n.n(s),o=n(1),l={tasks:[],events:[],activeTask:null,settings:{manDayDuration:i.Duration.fromObject({hours:7}),eventRetentionMonths:3},version:1},d=u.a.createContext({state:l,updateState:function(){}});function f(e){return JSON.stringify(e)}function v(e){var t=JSON.parse(e);if(1!==t.version)throw new Error('State in unsupported version "'.concat(t.version,'". Update the app.'));return Object(a.a)(Object(a.a)({},t),{},{events:t.events.map((function(e){return Object(a.a)(Object(a.a)({},e),{},{start_time:i.DateTime.fromISO(e.start_time),end_time:e.end_time&&i.DateTime.fromISO(e.end_time)})})),settings:Object(a.a)(Object(a.a)({},t.settings),{},{manDayDuration:i.Duration.fromISO(t.settings.manDayDuration)})})}function m(){var e=window.localStorage.getItem("state");return e?v(e):(b(l),l)}function b(e){window.localStorage.setItem("state",f(e))}function j(e){var t=e.children,n=u.a.useState(m),a=Object(r.a)(n,2),i=a[0],s=a[1],l=u.a.useRef(i),f=u.a.useRef(!1),v=u.a.useRef(null);u.a.useEffect((function(){return v.current=Object(c.debounce)((function(){f.current&&(b(l.current),f.current=!1)}),500,{trailing:!0,leading:!1}),function(){var e;return null===(e=v.current)||void 0===e?void 0:e.cancel()}}),[]),u.a.useEffect((function(){var e=function(){f.current&&(b(l.current),f.current=!1)},t=function(){f.current&&(b(l.current),f.current=!1)};return window.addEventListener("beforeunload",e),window.addEventListener("blur",t),function(){window.removeEventListener("beforeunload",e),window.removeEventListener("blur",t)}}),[]);return Object(o.jsx)(d.Provider,{value:{state:i,updateState:function(e){var t,n=e(i);l.current=n,f.current=!0,s(n),null===(t=v.current)||void 0===t||t.call(v)}},children:t})}function h(){return u.a.useContext(d)}}},[[22,1,2]]]);
//# sourceMappingURL=main.0cb3f3de.chunk.js.map